<!doctype html><meta content="width=device-width,initial-scale=1" name=viewport><title>wire</title><style>:root{--border-radius:10px}*{box-sizing:border-box;color:#fff;font-family:Arial,Helvetica,sans-serif;margin:0;user-select:none;-webkit-user-drag:none}:focus{outline:none}#main-menu,body,html{height:100%;width:100%}body{overflow:hidden}button{border:none;&:not(:disabled):not(.selected){cursor:pointer}}.center{left:50%;top:50%;translate:-50% -50%}#title{font-size:50px;font-weight:700;height:80px;line-height:80px;text-align:center}#main-menu,#title{background-color:#212121;width:100%}#main-menu{height:calc(100% - 80px)}#controls{background-color:#616161;border-radius:var(--border-radius);height:auto;padding:20px;position:relative;width:fit-content}#gun-select-container{height:100px;margin-bottom:20px}.btn-gun-select{background-color:#eee;border-radius:var(--border-radius);float:left;height:100%;padding:0;transition:rotate .5s,filter .5s,scale .5s,background-color .5s;width:100px;&:not(:last-child){margin-right:10px}&.selected{background-color:#4caf50;rotate:-90deg;>img{filter:invert(1)}}&:not(:disabled):not(.selected){background-color:#9e9e9e;&:focus{border:2px solid #fff;rotate:-90deg;scale:1.1;>img{margin:-12px}}&:hover{background-color:#bdbdbd;rotate:-90deg;scale:1.1}&:active{background-color:#757575}}>img{margin:-10px;transition:inherit;width:120px}&:disabled>img{filter:opacity(50%)}}#btn-spawn{background-color:#80cbc4;border-radius:var(--border-radius);font-size:24px;height:40px;left:50%;position:relative;translate:-50%;width:200px;&:not(:disabled){background-color:#009688;&:focus{border:2px solid #fff}&:hover{background-color:#26a69a}&:active{background-color:#00897b}}}#connection-status{background-color:#424242;border-radius:var(--border-radius);bottom:5px;font-size:30px;left:50%;padding:5px;position:absolute;text-align:center;translate:-50%;width:350px}#canvas{display:none;position:absolute;top:0}</style><canvas id=canvas></canvas><p id=title>wire<div id=main-menu><div id=controls class=center><div id=gun-select-container><button class="btn-gun-select selected" data-gun=0 tabindex=-1><img alt=Pistol src=img/icons/pistol.png title=Pistol></button><button class=btn-gun-select data-gun=1><img alt=SMG src=img/icons/smg.png title=SMG></button><button class=btn-gun-select data-gun=2><img alt=Shotgun src=img/icons/shotgun.png title=Shotgun></button><button class=btn-gun-select data-gun=3><img alt=Assault src=img/icons/assault.png title=Assault></button><button class=btn-gun-select data-gun=4><img alt=Sniper src=img/icons/sniper.png title=Sniper></button><button class=btn-gun-select data-gun=5><img alt=LMG src=img/icons/lmg.png title=LMG></button></div><button disabled id=btn-spawn>Spawn</button></div><p id=connection-status>Loading</div><script type=module>import*as e from'./src/animations.js';import*as t from'./src/easings.js';const n=1e3,i={Spawned:0,WallAdd:1,PlayerAdd:2,BulletAdd:3,Update:4,Died:5};i.MAX=i.Died;const a={Pistol:0,SMG:1,Shotgun:2,Assault:3,Sniper:4,LMG:5},l=(e,t=document)=>'string'==typeof e?t.querySelector(e):e,o=(e,t=document)=>'string'==typeof e?t.querySelectorAll(e):e,r=(e,t,n)=>l(e).addEventListener(n?t:t.name,n||t),s=(e,t='block')=>l(e).style.display=t,c=e=>l(e).style.display='none';Math.angle=(e,t,n,i)=>Math.atan2(i-t,n-e);const g={},d={KeyA:0,KeyD:1,KeyW:2,KeyS:3,KeyR:5},h={};for(const e in a)h[a[e]]=new Image,h[a[e]].src=`img/icons/${e.toLowerCase()}.png`;const f={x:0,y:0},y={z:1,backgroundColor:'#0005',panelBackgroundColor:'#0007',showMinimap:1,margin:3,padding:3},u={x:5,y:5,z:.02,backgroundColor:'#0005',playerSize:3,playerColor:'yellow',showPlayers:1,playersSize:3,playersColor:'red'},m={a:.1,size:20,color:'black'},x={width:0,height:0},p=new Map,w={id:0,x:0,y:0,vX:0,vY:0,gun:0,bullets:0,reloading:0,magSize:0,health:0,maxHealth:0,score:0,kills:0,angle:0},S=[],b=new Map,k=new Map,U=60;let P,v=0;const z=l('#title'),M=l('#main-menu'),T=(l('#controls'),l('#connection-status')),A=l('#canvas'),I=l('#btn-spawn'),W=A.getContext('2d'),C={x:0,y:0,z:1};let E,O;async function D(){s(z),s(M);const i=z.animate(e.SLIDE_IN_LEFT,{duration:n}),a=z.animate(e.FADE_IN,{duration:n}),l=M.animate(e.ZOOM_IN,{duration:n}),o=M.animate(e.FADE_IN,{duration:n}),r=M.animate(e.SLIDE_IN_RIGHT,{duration:n}),g=setInterval((()=>{C.z=1-t.easeOutBounce(i.currentTime/i.effect.getComputedTiming().activeDuration)}));await Promise.all([i.finished,a.finished,l.finished,o.finished,r.finished]),clearInterval(g),c(A)}function F(){T.innerText='Connected',T.style.backgroundColor='#4CAF50',I.disabled=0}function H({data:e}){if('string'==typeof e)return;const t=e.byteLength;if(!t)return;const n=new DataView(e),a=n.getUint8();if(a>i.MAX)return;const l=g[a];l&&l(e,t,n,a)}function R(){}async function _({code:e,reason:t}){T.innerText='Disconnected',T.style.backgroundColor='#F44336',I.disabled=1,v&&(v=0,await D(),clearTimeout(E))}function B(e,t){return new Uint8Array([1,e,+t])}async function L(){v=1,C.x=w.x,C.y=w.y,O=Date.now(),K(),await async function(){s(A);const i=z.animate(e.SLIDE_OUT_RIGHT,{duration:n}),a=z.animate(e.FADE_OUT,{duration:n}),l=M.animate(e.ZOOM_OUT,{duration:n}),o=M.animate(e.FADE_OUT,{duration:n}),r=M.animate(e.SLIDE_OUT_LEFT,{duration:n}),g=setInterval((()=>{C.z=t.easeOutBounce(i.currentTime/i.effect.getComputedTiming().activeDuration)}));await Promise.all([i.finished,a.finished,l.finished,o.finished,r.finished]),clearInterval(g),C.z=1,c(z),c(M)}()}function N(e){W.beginPath(),W.rect(e.x+4,e.y+4,e.width-8,e.height-8),W.closePath(),W.strokeStyle=e.active?'green':'gray',W.fillStyle='white',W.lineWidth=8,W.fill(),W.stroke()}function X(e){W.beginPath(),W.rect(e.x+2,e.y+2,e.width-4,e.height-4),W.closePath(),W.strokeStyle='black',W.fillStyle='green',W.lineWidth=4,W.fill(),W.stroke()}function Y(e){const t={x:e.x-2*Math.cos(e.angle),y:e.y-2*Math.sin(e.angle)},n={x:e.x+2*Math.cos(e.angle),y:e.y+2*Math.sin(e.angle)};W.beginPath(),W.moveTo(t.x,t.y),W.lineTo(n.x,n.y),W.closePath(),W.strokeStyle='black',W.lineWidth=3,W.stroke()}function K(){const e=Date.now();(function(e){w.x+=w.vX*e,w.y+=w.vY*e;for(const[t,n]of k)n.x+=n.vX*e,n.y+=n.vY*e;for(const[t,n]of b)n.x+=n.vX*e,n.y+=n.vY*e;W.clearRect(0,0,A.width,A.height),W.fillStyle='#efeff5',W.fillRect(0,0,A.width,A.height),W.save(),W.translate(A.width/2-C.z*C.x,A.height/2-C.z*C.y),W.scale(C.z,C.z),function(e,t){W.beginPath();for(let n=0;n<t.width;n+=e.size)W.moveTo(n,0),W.lineTo(n,t.height);for(let n=0;n<t.height;n+=e.size)W.moveTo(0,n),W.lineTo(t.width,n);W.closePath(),W.strokeStyle=e.color,W.lineWidth=1,W.globalAlpha=e.a,W.stroke(),W.globalAlpha=1}(m,x),W.beginPath(),W.rect(0,0,x.width,x.height),W.closePath(),W.strokeStyle='black',W.lineWidth=5,W.stroke(),function(e){for(const[,t]of e)N(t)}(p),function(e){for(const t of e)X(t)}(S),function(e){for(const[,t]of e)Y(t)}(k),function(e){for(const[,t]of e){W.beginPath(),W.arc(t.x,t.y,22,0,2*Math.PI),W.closePath(),W.strokeStyle='black',W.lineWidth=4,W.stroke(),W.beginPath(),W.arc(t.x,t.y,t.health/t.maxHealth*20,0,2*Math.PI),W.closePath(),W.fillStyle='red',W.fill();const e={x:t.x+20*Math.cos(t.angle),y:t.y+20*Math.sin(t.angle)},n={x:t.x+50*Math.cos(t.angle),y:t.y+50*Math.sin(t.angle)};W.beginPath(),W.moveTo(e.x,e.y),W.lineTo(n.x,n.y),W.closePath(),W.strokeStyle=t.reloading?'red':'black',W.lineWidth=5,W.stroke()}}(b),function(e){W.beginPath(),W.arc(e.x,e.y,22,0,2*Math.PI),W.closePath(),W.strokeStyle='black',W.lineWidth=4,W.stroke(),W.beginPath(),W.arc(e.x,e.y,e.health/e.maxHealth*20,0,2*Math.PI),W.closePath(),W.fillStyle='yellow',W.fill();const t={x:e.x+20*Math.cos(e.angle),y:e.y+20*Math.sin(e.angle)},n={x:e.x+50*Math.cos(e.angle),y:e.y+50*Math.sin(e.angle)};W.beginPath(),W.moveTo(t.x,t.y),W.lineTo(n.x,n.y),W.closePath(),W.strokeStyle=e.reloading?'red':'black',W.lineWidth=5,W.stroke()}(w),W.restore(),function(e,t){const n=e.z;e.showMinimap&&function(e,t,n,i,a){W.strokeStyle='black',W.lineWidth=2,W.strokeRect(e.x,e.x,t.width*e.z,t.height*e.z),W.fillStyle=e.backgroundColor,W.fillRect(e.x,e.x,t.width*e.z,t.height*e.z),W.lineWidth=1;for(const[,t]of n)W.strokeStyle=t.active?'green':'gray',W.strokeRect(e.x+t.x*e.z,e.x+t.y*e.z,t.width*e.z,t.height*e.z);if(e.showPlayers)for(const[,t]of a)W.beginPath(),W.arc(e.x+t.x*e.z,e.y+t.y*e.z,e.playersSize,0,2*Math.PI),W.closePath(),W.fillStyle=e.playersColor,W.fill();W.beginPath(),W.arc(e.x+i.x*e.z,e.y+i.y*e.z,e.playerSize,0,2*Math.PI),W.closePath(),W.fillStyle=e.playerColor,W.fill()}(u,x,p,t,b),W.fillStyle=e.backgroundColor,W.fillRect(e.padding,innerHeight-e.padding-26*n,206*n,26*n),W.fillStyle='#E32828cc',W.fillRect(e.padding+3*n,innerHeight-e.padding-23*n,t.health/t.maxHealth*200*n,20*n),W.font=16*n+'px monospace',W.textAlign='center',W.textBaseline='middle',W.fillStyle='white',W.fillText(`${t.health}/${t.maxHealth}`,e.padding+103*n,innerHeight-e.padding-26*n+15*n);const i=[t,...b.values()].sort(((e,t)=>t.score-e.score)),a=150,l=innerWidth-e.padding-a*n,o=150*n+11*e.margin*n;W.fillStyle=e.backgroundColor,W.fillRect(l-2*e.margin*n,e.padding,a*n+2*e.margin*n,o);let r=e.padding+e.margin*n;for(let t=0;t<Math.min(10,i.length);t++){const o=i[t];W.fillStyle=e.panelBackgroundColor,W.fillRect(l-e.margin*n,r,a*n,15*n),W.font=14*n+'px monospace',W.fillStyle='white',W.textBaseline='middle',W.textAlign='left',W.fillText(''+o.score,l,r+7.5*n+1),W.textAlign='right',W.fillText('Kills: '+o.kills,l-2*e.margin*n+a*n,r+7.5*n+1),r+=15*n+e.margin*n}const s=innerWidth-e.padding-75*n,c=innerHeight-e.padding-20*n,g=c-e.margin*n-30*n;W.fillStyle=e.backgroundColor,W.fillRect(s-2*e.margin*n,g-2*e.margin*n,75*n+2*e.margin*n,30*n+e.margin*n+20*n+2*e.margin*n),W.drawImage(h[t.gun],s-e.margin*n+75*n/2-32*n,g-2*e.margin*n-48*n,64*n,64*n),W.fillStyle=e.panelBackgroundColor,W.fillRect(s-e.margin*n,g-e.margin*n,75*n,30*n),W.fillRect(s-e.margin*n,c-e.margin*n,75*n,20*n),W.font=18*n+'px monospace',W.textAlign='center',W.textBaseline='middle',W.fillStyle='white',W.fillText(`${t.bullets}/${t.magSize}`,s-e.margin*n+37.5*n,g-e.margin*n+15*n+1),t.reloading&&(W.font=14*n+'px Arial',W.textAlign='center',W.textBaseline='middle',W.fillStyle='yellow',W.fillText('Reloading',s-e.margin*n+37.5*n,c-e.margin*n+10*n+1))}(y,w)})((e-O)/1e3),O=e,E=setTimeout(K,1e3/U)}function $(){A.width=innerWidth,A.height=innerHeight}g[i.Spawned]=(e,t,n)=>{if(7===t)return w.x=n.getUint16(1),w.y=n.getUint16(3),w.magSize=n.getUint8(5),w.maxHealth=w.health=n.getUint8(6),void L();if(t<13)return;x.width=n.getUint16(1),x.height=n.getUint16(3);const i=n.getUint8(5);let a=6;for(;a<7*i+6;a+=7){const e={id:n.getUint8(a),x:n.getUint16(a+1),y:n.getUint16(a+3),width:n.getUint8(a+5),height:n.getUint8(a+6),active:0};p.set(e.id,e)}w.id=n.getUint8(a),w.x=n.getUint16(a+1),w.y=n.getUint16(a+3),w.magSize=n.getUint8(a+5),w.maxHealth=w.health=n.getUint8(a+6),u.z=1/(x.width/150),L()},g[i.WallAdd]=(e,t,n)=>{if(!((t-1)%6))for(let e=1;e<t;e+=6){const t={x:n.getUint16(e),y:n.getUint16(e+2),width:n.getUint8(e+4),height:n.getUint8(e+5)};S.push(t)}},g[i.PlayerAdd]=(e,t,n)=>{if(!((t-1)%7))for(let e=1;e<t;e+=7){const t=n.getUint8(e),i={id:t,x:n.getUint16(e+1),y:n.getUint16(e+3),vX:0,vY:0,gun:n.getUint8(e+5),maxHealth:n.getUint8(e+6),score:0,kills:0,angle:0,reloading:0};i.health=i.maxHealth,b.set(t,i)}},g[i.BulletAdd]=(e,t,n)=>{if(!((t-1)%14))for(let e=1;e<t;e+=14){const t=n.getUint16(e),i=n.getFloat32(e+6),a=n.getFloat32(e+10),l={x:Math.cos(a),y:Math.sin(a)},o={x:l.x*i,y:l.y*i},r={id:t,x:n.getUint16(e+2),y:n.getUint16(e+4),vX:o.x,vY:o.y,speed:i,angle:a};k.set(t,r)}},g[i.Update]=(e,t,n)=>{w.bullets=n.getUint8(1),w.reloading=!!n.getUint8(2);const i=2*n.getUint8(3);let a=4;for(;a<i+4;a+=2)p.get(n.getUint8(a)).active=!!n.getUint8(a+1);const l=n.getUint8(a)+1;a++;const o=29*l,r=[];for(;a<i+o+5;a+=29){const e=n.getUint8(a),t=n.getFloat32(a+1),i=n.getFloat32(a+5),l=n.getFloat32(a+9),o=n.getFloat32(a+13),s=n.getFloat32(a+17),c=n.getUint8(a+21),g=n.getUint32(a+22),d=n.getUint16(a+26),h=!!n.getUint8(a+28);if(e===w.id)w.x=t,w.y=i,w.vX=l,w.vY=o,w.health=c,w.score=g,w.kills=d;else if(b.has(e)){const n=b.get(e);n.x=t,n.y=i,n.vX=l,n.vY=o,n.health=c,n.angle=s,n.score=g,n.kills=d,n.reloading=h,r.push(e)}}for(const[e]of b)r.includes(e)||b.delete(e);C.x=w.x,C.y=w.y;const s=n.getUint16(a);a+=2;const c=10*s,g=[];for(;a<i+o+c+7;a+=10){const e=n.getUint16(a);n.getFloat32(a+2),n.getFloat32(a+6),k.has(e)&&(k.get(e),g.push(e))}for(const[e]of k)g.includes(e)||k.delete(e)},g[i.Died]=()=>{!async function(){I.disabled=0,v=0,await D(),clearTimeout(E)}()},r(I,'click',(function(){var e;P.readyState===WebSocket.OPEN&&(w.gun=+l('.btn-gun-select.selected').dataset.gun,P.send((e=w.gun,new Uint8Array([0,e]))),I.disabled=1)})),r(document,'keydown',(function({code:e,repeat:t}){if(t||!v)return;if('KeyQ'===e&&(C.z-=.1),'KeyE'===e&&(C.z+=.1),'Minus'===e&&(y.z-=.1),'Equal'===e&&(y.z+=.1),!Object.hasOwn(d,e))return;if(P.readyState!==WebSocket.OPEN)return;const n=d[e];P.send(B(n,1))})),r(document,'keyup',(function({code:e}){if(!v)return;if(!Object.hasOwn(d,e))return;if(P.readyState!==WebSocket.OPEN)return;const t=d[e];P.send(B(t,0))})),r(document,'mousemove',(function({clientX:e,clientY:t}){if(!v)return;f.x=e,f.y=t;const n=Math.angle(w.x-C.x,w.y-C.y,f.x-innerWidth/2,f.y-innerHeight/2);w.angle=n,P.readyState===WebSocket.OPEN&&P.send(function(e){const t=new ArrayBuffer(5),n=new DataView(t);return n.setUint8(0,2),n.setFloat32(1,e),t}(n))})),r(document,'mousedown',(function(){v&&P.readyState===WebSocket.OPEN&&P.send(B(4,1))})),r(document,'mouseup',(function(){v&&P.readyState===WebSocket.OPEN&&P.send(B(4,0))})),r(window,'resize',$),r(window,'load',(function(){P=new WebSocket('wss://wire-epyi.onrender.com'),P.binaryType='arraybuffer',T.innerText='Connecting',T.style.backgroundColor='#2196F3',s(T),r(P,'open',F),r(P,'message',H),r(P,'error',R),r(P,'close',_)})),o('.btn-gun-select').forEach((e=>{r(e,'click',(()=>{o('.btn-gun-select').forEach((e=>{e.classList.remove('selected'),e.removeAttribute('tabIndex')})),e.classList.add('selected'),e.setAttribute('tabIndex',-1)}))})),$();</script>